!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("jQuery"),require("Handlebars")):"function"==typeof define&&define.amd?define(["jQuery","Handlebars"],e):"object"==typeof exports?exports.de=e(require("jQuery"),require("Handlebars")):t.de=e(t.jQuery,t.Handlebars)}(this,function(t,e){return function(t){function e(n){if(i[n])return i[n].exports;var o=i[n]={exports:{},id:n,loaded:!1};return t[n].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.MappedJS=void 0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(1),l=n(a),u=i(2),h=i(3),c=i(4),d=i(16),v=i(19),f=i(8);e.MappedJS=function(){function t(){var e=this,i=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=i.container,r=void 0===n?".mjs":n,s=i.mapData,a=void 0===s?{}:s,l=i.markerData,u=void 0===l?{}:l,h=i.mapSettings,c=void 0===h?{}:h,d=i.events,v=void 0===d?{loaded:"mjs-loaded"}:d;return o(this,t),this.initializeSettings(r,v,c),this.initializeData(a,function(t){e.mapData=t,e.initializeData(u,function(t){e.mapData=Object.assign(e.mapData,t),e.initializeMap(),e.addControls(),e.bindEvents(),e.loadingFinished()})}),this.momentum=null,this.keyTicks=0,this}return s(t,[{key:"addControls",value:function(){this.mapSettings.controls&&(this.$controls=(0,l["default"])('<div class="control-container '+this.mapSettings.controls.theme+" "+this.mapSettings.controls.position+'" />'),this.$zoomIn=(0,l["default"])("<div class='control zoom-in' />"),this.$zoomOut=(0,l["default"])("<div class='control zoom-out' />"),this.$home=(0,l["default"])("<div class='control home' />"),this.$controls.append(this.$home).append(this.$zoomIn).append(this.$zoomOut),this.$content.append(this.$controls))}},{key:"initializeSettings",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],i=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];if(this.$container="string"==typeof t?(0,l["default"])(t):"object"===("undefined"==typeof t?"undefined":r(t))&&t instanceof jQuery?t:(0,l["default"])(t),!(this.$container instanceof jQuery))throw new Error("Container "+t+" not found");return this.$container.addClass("mappedJS"),this.$content=(0,l["default"])("<div class='map-content' />"),this.$container.append(this.$content),this.mapSettings=d.DataEnrichment.mapSettings(i),this.events=e,this}},{key:"initializeData",value:function(t,e){return"string"==typeof t?u.Helper.requestJSON(t,function(t){e(t)}):e("object"===("undefined"==typeof t?"undefined":r(t))?t:null),this}},{key:"initializeMap",value:function(){return this.tileMap=new c.TileMap({container:this.$content,tilesData:this.mapData,settings:this.mapSettings}),this}},{key:"getAbsolutePosition",value:function(t){return t.clone.multiply(this.tileMap.view.viewport.width,this.tileMap.view.viewport.height)}},{key:"initializeInteractForMap",value:function(){var t=this;return this.interact=new v.Interact({container:this.$content,autoFireHold:300,overwriteViewportSettings:!0,callbacks:{pan:function(e){if((0,l["default"])(e.target).hasClass("control"))return!1;var i=e.last.position.clone.substract(e.position.move);t.tileMap.moveView(t.getAbsolutePosition(i).multiply(-1,-1))},wheel:function(e){var i=e.delta/4;t.tileMap.zoom(i,t.getAbsolutePosition(e.position.start))},pinch:function(e){t.tileMap.zoom(3*e.difference,t.getAbsolutePosition(e.position.move))},doubletap:function(e){return(0,l["default"])(e.target).hasClass("marker-container")?void t.tileMap.zoom(.2,t.getAbsolutePosition(e.position.start)):!1},flick:function(e){var i=new f.Point(e.directions[0],e.directions[1]),n=i.clone.divide(e.speed).multiply(20);t.momentumAccerlation(n)}}}),this}},{key:"bindEvents",value:function(){this.initializeInteractForMap(),(0,l["default"])(window).on(h.Events.Handling.RESIZE,this.resizeHandler.bind(this)),(0,l["default"])(document).on(h.Events.Handling.KEYDOWN,this.keyPress.bind(this)),(0,l["default"])(document).on(h.Events.Handling.KEYUP,this.keyRelease.bind(this));var t=u.Helper.isTouch()?h.Events.Handling.TOUCHSTART:h.Events.Handling.CLICK;return this.$zoomIn.on(t,this.zoomInToCenter.bind(this)),this.$zoomOut.on(t,this.zoomOutToCenter.bind(this)),this.$home.on(t,this.resetToInitialState.bind(this)),this}},{key:"resetToInitialState",value:function(){return this.tileMap.reset(),this}},{key:"zoomInToCenter",value:function(){return this.tileMap.zoom(.1,this.tileMap.view.viewport.center),this}},{key:"zoomOutToCenter",value:function(){return this.tileMap.zoom(-.1,this.tileMap.view.viewport.center),this}},{key:"keyPress",value:function(t){switch(t.keyCode){case 38:this.handleMovementByKeys(new f.Point(0,1));break;case 37:this.handleMovementByKeys(new f.Point(1,0));break;case 39:this.handleMovementByKeys(new f.Point(-1,0));break;case 40:this.handleMovementByKeys(new f.Point(0,-1));break;case 187:case 107:this.zoomInToCenter();break;case 189:case 109:this.zoomOutToCenter();break;case 72:this.resetToInitialState()}return this.tileMap.view.drawIsNeeded=!0,this}},{key:"handleMovementByKeys",value:function(t){return this.keyTicks++,this.tileMap.moveView(t.multiply(this.keyTicks)),this}},{key:"keyRelease",value:function(){this.keyTicks=0}},{key:"momentumAccerlation",value:function(t){return this.maxMomentumSteps=30,this.triggerMomentum(this.maxMomentumSteps,10,t.multiply(-1)),this}},{key:"triggerMomentum",value:function(t,e,i){var n=this;return this.momentum=setTimeout(function(){t--;var o=u.Helper.easeOutQuadratic((n.maxMomentumSteps-t)*e,i,i.clone.multiply(-1),e*n.maxMomentumSteps);n.tileMap.moveView(o),t>=0&&n.triggerMomentum(t,e,i)},e),this}},{key:"resizeHandler",value:function(){return this.tileMap.resize(),this}},{key:"loadingFinished",value:function(){return this.$container.trigger(this.events.loaded),this}}]),t}()},function(e,i){e.exports=t},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=e.Helper={requestJSON:function(t,e){return i.getFile(t,function(t){e&&e(JSON.parse(t))}),this},loadImage:function(t,e){var i=new Image;return i.onload=function(){e&&"function"==typeof e&&e(i)},i.src=t,this},getFile:function(t,e){var i=new XMLHttpRequest;return i.onreadystatechange=function(){if(i.readyState===XMLHttpRequest.DONE){if(200!==i.status)throw new Error("The JSON submitted seems not valid",i);e&&e(i.responseText)}},i.open("GET",t,!0),i.send(),this},forEach:function(t,e){for(var i in t)t[i]&&"function"==typeof e&&e(t[i],i);return this},easeOutQuadratic:function(t,e,i,n){return t/=n,i.clone.multiply(-1*t*(t-2)).add(e)},toRadians:function(t){return t*Math.PI/180},isMouse:function(){return"onmousedown"in window},isTouch:function(){return"ontouchstart"in window||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0},isIE:function(){return navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0},scrollEvent:function(){return"onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll"}}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Events={ToolTip:{OPEN:"tooltip-open",CLOSE:"tooltip-close"},Marker:{DEACTIVATE:"deactivate-marker"},Publisher:{PUBLISH:"publish",SUBSCRIBE:"subscribe",UNSUBSCRIBE:"unsubscribe"},TileMap:{IMG_DATA_NAME:"img_data",MARKER_DATA_NAME:"marker",NEXT_LEVEL:"next-level",PREVIOUS_LEVEL:"previous-level",RESIZE:"resize",ZOOM_TO_BOUNDS:"zoom-to-bounds"},Handling:{RESIZE:"resize orientationchange",CLICK:"click",TOUCHSTART:"touchstart",MOUSEDOWN:"mousedown",TOUCHEND:"touchend",MOUSEUP:"mouseup",KEYDOWN:"keydown",KEYUP:"keyup"},View:{DRAW:"draw",THUMB_LOADED:"thumb-loaded"},MarkerClusterer:{CLUSTERIZE:"clusterize",UNCLUSTERIZE:"unclusterize"}}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.TileMap=void 0;var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=i(1),a=n(s),l=i(2),u=i(3),h=i(5),c=i(6),d=i(7),v=i(9),f=i(15),p=i(16),g=i(17),y=i(13);e.TileMap=function(){function t(e){var i=this,n=e.container,r=void 0===n?null:n,s=e.tilesData,a=void 0===s?{}:s,d=e.settings,v=void 0===d?{}:d;if(o(this,t),!r)throw Error("You must define a container to initialize a TileMap");return this.$container=r,this.imgData=a[u.Events.TileMap.IMG_DATA_NAME],this.markerData=a[u.Events.TileMap.MARKER_DATA_NAME],this.settings=v,this.stateHandler=new c.StateHandler([{value:0,description:"start"},{value:1,description:"view-initialized"},{value:2,description:"marker-initialized"},{value:3,description:"tooltip-initialized"}]),this.templates=p.DataEnrichment.tooltip(this.settings.tooltip.templates),this.levels=[],this.clusterHandlingTimeout=null,this.initial={bounds:v.bounds,center:v.center,level:v.level,zoom:v.zoom},this.initializeCanvas(),l.Helper.forEach(this.imgData,function(t,e){var n={value:t,description:e,instance:i.createViewFromData(v.bounds,v.center,t,v.zoom)};i.levels.push(n)}),this.levelHandler=new c.StateHandler(this.levels),this.levelHandler.changeTo(this.settings.level),this.view.init(),this.eventManager=new h.Publisher,this.drawIsNeeded=!1,this.appendMarkerContainerToDom(),this.bindEvents(),this.stateHandler.next(),this.resizeCanvas(),window.requestAnimFrame(this.mainLoop.bind(this)),this}return r(t,[{key:"left",get:function(){return this.$container.position().left-this.$container.offset().left}},{key:"top",get:function(){return this.$container.position().top-this.$container.offset().top}},{key:"width",get:function(){return this.$container.innerWidth()}},{key:"height",get:function(){return this.$container.innerHeight()}},{key:"currentLevelData",get:function(){return this.levelHandler.current.value}},{key:"view",get:function(){return this.levelHandler.current.instance}}]),r(t,[{key:"reset",value:function(){this.levelHandler.current.description!==this.settings.level&&this.levelHandler.changeTo(this.settings.level),this.view.reset(),this.redraw(),this.clusterHandler()}},{key:"createViewFromData",value:function(t,e,i,n){return new v.View({viewport:new d.Rectangle(this.left,this.top,this.width,this.height),currentView:new d.Rectangle(0,0,i.dimensions.width,i.dimensions.height),bounds:t,center:e,initialCenter:this.initial.center,data:i,maxZoom:i.zoom?i.zoom.max:1,currentZoom:n,minZoom:i.zoom?i.zoom.min:1,$container:this.$container,context:this.canvasContext,limitToBounds:this.settings.limitToBounds})}},{key:"repositionMarkerContainer",value:function(){if(this.$markerContainer){var t=this.view.currentView.getDistortedRect(this.view.distortionFactor);this.$markerContainer.css({width:t.width+"px",height:t.height+"px",left:t.left+this.view.offsetToCenter+"px",top:t.top+"px"})}return this}},{key:"enrichMarkerData",value:function(t){return p.DataEnrichment.marker(t)}},{key:"initializeMarkers",value:function(){var t=this;return this.markerData&&!function(){var e=[];t.markerData=t.enrichMarkerData(t.markerData),l.Helper.forEach(t.markerData,function(i){e.push(new f.Marker(i,t))}),e=e.sort(function(t,e){return e.latlng.lat-t.latlng.lat!==0?e.latlng.lat-t.latlng.lat:e.latlng.lng-t.latlng.lng}),l.Helper.forEach(e,function(t,e){t.$icon.css("z-index",e)}),0!==e.length&&t.createTooltipContainer(),t.markerClusterer=new y.MarkerClusterer({markers:e,$container:t.$markerContainer})}(),this.stateHandler.next(),this}},{key:"appendMarkerContainerToDom",value:function(){return this.$markerContainer=(0,a["default"])("<div class='marker-container' />"),this.$container.append(this.$markerContainer),this}},{key:"createTooltipContainer",value:function(){return this.tooltip=new g.ToolTip({container:(0,a["default"])(this.$container.parent()),templates:this.templates}),this.stateHandler.next(),this}},{key:"bindEvents",value:function(){var t=this;return this.eventManager.subscribe(u.Events.TileMap.RESIZE,function(){t.resize()}),this.eventManager.subscribe(u.Events.View.THUMB_LOADED,function(){t.redraw(),t.stateHandler.current.value<2&&t.initializeMarkers()}),this.eventManager.subscribe(u.Events.TileMap.ZOOM_TO_BOUNDS,function(e){var i=Math.min(t.view.viewport.width/e.width,t.view.viewport.height/e.height);t.zoom(i,e.center)}),this.eventManager.subscribe(u.Events.TileMap.NEXT_LEVEL,function(){var e=t.levelHandler.current.description,i=t.view.currentView.center;t.changelevel(1),e!==t.levelHandler.current.description&&t.setViewToOldView(i,1e-15,t.view.minZoom)}),this.eventManager.subscribe(u.Events.TileMap.PREVIOUS_LEVEL,function(){var e=t.levelHandler.current.description,i=t.view.currentView.center;t.changelevel(-1),e!==t.levelHandler.current.description&&t.setViewToOldView(i,-1e-15,t.view.maxZoom)}),this}},{key:"setViewToOldView",value:function(t,e,i){this.view.zoomFactor=i,this.view.zoom(e,this.view.viewport.center),this.view.currentView.setCenter(t),this.drawIsNeeded=!0}},{key:"changelevel",value:function(t){0>t?this.levelHandler.previous():this.levelHandler.next(),this.view.isInitialized||this.view.init()}},{key:"initializeCanvas",value:function(){return this.$canvas=(0,a["default"])("<canvas class='mjs-canvas' />"),this.canvas=this.$canvas[0],this.$container.append(this.$canvas),this.canvasContext=this.canvas.getContext("2d"),this}},{key:"redraw",value:function(){return this.drawIsNeeded=!0,this}},{key:"resize",value:function(){return this.resizeCanvas().resizeView().redraw()}},{key:"moveView",value:function(t){return this.view.moveView(t),this.redraw(),this}},{key:"zoom",value:function(t,e){return 0!==t&&(this.view.zoom(t,e),this.clusterHandler(),this.redraw()),this}},{key:"clusterHandler",value:function(){var t=this;this.clusterHandlingTimeout&&(this.clusterHandlingTimeout=clearTimeout(this.clusterHandlingTimeout)),this.clusterHandlingTimeout=setTimeout(function(){t.levelHandler.hasNext()?t.eventManager.publish(u.Events.MarkerClusterer.CLUSTERIZE):t.eventManager.publish(u.Events.MarkerClusterer.UNCLUSTERIZE)},150)}},{key:"resizeCanvas",value:function(){return this.canvasContext.canvas.width=this.width,this.canvasContext.canvas.height=this.height,this}},{key:"resizeView",value:function(){var t=this.view.viewport.clone;this.view.viewport.size(this.left,this.top,this.width,this.height);var e=this.view.viewport.center.substract(t.center);return this.view.currentView.translate(e.x,e.y),this}},{key:"mainLoop",value:function(){var t=this;this.drawIsNeeded&&(this.canvasContext.clearRect(0,0,this.width,this.height),this.view.checkBoundaries(),this.view.draw(),this.repositionMarkerContainer(),this.drawIsNeeded=!1),window.requestAnimFrame(function(){return t.mainLoop()})}}]),t}();window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}()},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.Publisher=void 0;var o=function(){function t(t,e){var i=[],n=!0,o=!1,r=void 0;try{for(var s,a=t[Symbol.iterator]();!(n=(s=a.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(l){o=!0,r=l}finally{try{!n&&a["return"]&&a["return"]()}finally{if(o)throw r}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=i(3),a=null;e.Publisher=function(){function t(){return n(this,t),a||(this.subscribers={},a=this),a}return r(t,[{key:"subscribe",value:function(){var t=arguments.length<=0||void 0===arguments[0]?"any":arguments[0],e=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1];return this.subscribers[t]||(this.subscribers[t]=[]),this.subscribers[t].push(e),this}},{key:"unsubscribe",value:function(){var t=arguments.length<=0||void 0===arguments[0]?"any":arguments[0],e=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1];return this.handle(s.Events.Publisher.UNSUBSCRIBE,t,e)}},{key:"publish",value:function(){var t=arguments.length<=0||void 0===arguments[0]?"any":arguments[0],e=arguments.length<=1||void 0===arguments[1]?[]:arguments[1];return this.handle(s.Events.Publisher.PUBLISH,t,e)}},{key:"handle",value:function(t,e,i){var n=this.subscribers[e]?this.subscribers[e]:[],r=!0,a=!1,l=void 0;try{for(var u,h=n.entries()[Symbol.iterator]();!(r=(u=h.next()).done);r=!0){var c=o(u.value,2),d=c[0],v=c[1];t===s.Events.Publisher.PUBLISH?v(i):v===i&&n.splice(d,1)}}catch(f){a=!0,l=f}finally{try{!r&&h["return"]&&h["return"]()}finally{if(a)throw l}}return this}},{key:"destroy",value:function(){a=null}}]),t}()},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){var i=[],n=!0,o=!1,r=void 0;try{for(var s,a=t[Symbol.iterator]();!(n=(s=a.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(l){o=!0,r=l}finally{try{!n&&a["return"]&&a["return"]()}finally{if(o)throw r}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();e.StateHandler=function(){function t(){var e=arguments.length<=0||void 0===arguments[0]?[{value:0,description:"Default"}]:arguments[0];return i(this,t),this.states=e,this.i=0,this.lastState=this.current,this}return o(t,[{key:"current",get:function(){return this.states[this.i]}},{key:"length",get:function(){return this.states.length}}]),o(t,[{key:"next",value:function(){return this.lastState=this.current,this.hasNext()&&this.i++,this}},{key:"previous",value:function(){return this.lastState=this.current,this.hasPrevious()&&this.i--,this}},{key:"changeTo",value:function(t){return t>=0&&t<this.length&&(this.i=t),this}},{key:"changeToValue",value:function(t,e){var i=!0,o=!1,r=void 0;try{for(var s,a=this.states[Symbol.iterator]();!(i=(s=a.next()).done);i=!0){var l=n(s.value,2),u=l[0],h=l[1];if(e===h[t]){this.i=u;break}}}catch(c){o=!0,r=c}finally{try{!i&&a["return"]&&a["return"]()}finally{if(o)throw r}}return this}},{key:"hasNext",value:function(){return this.i<this.length-1}},{key:"hasPrevious",value:function(){return this.i>0}}]),t}()},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0}),e.Rectangle=void 0;var s=function h(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:h(o,e,i)}if("value"in n)return n.value;var r=n.get;if(void 0!==r)return r.call(i)},a=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),l=i(8),u=e.Rectangle=function(t){function e(){var t,i=arguments.length<=0||void 0===arguments[0]?0:arguments[0],r=arguments.length<=1||void 0===arguments[1]?0:arguments[1],s=arguments.length<=2||void 0===arguments[2]?0:arguments[2],a=arguments.length<=3||void 0===arguments[3]?0:arguments[3];n(this,e);var l=o(this,Object.getPrototypeOf(e).call(this,i,r));return l.width=s,l.height=a,t=l,o(l,t)}return r(e,t),a(e,[{key:"center",get:function(){return new l.Point(this.x+this.width/2,this.y+this.height/2)}},{key:"topLeft",get:function(){return new l.Point(this.x,this.y)}},{key:"topRight",get:function(){return new l.Point(this.x+this.width,this.y)}},{key:"bottomLeft",get:function(){return new l.Point(this.x,this.y+this.height)}},{key:"bottomRight",get:function(){return new l.Point(this.x+this.width,this.y+this.height)}},{key:"right",get:function(){return this.x+this.width}},{key:"left",get:function(){return this.x}},{key:"top",get:function(){return this.y}},{key:"bottom",get:function(){return this.y+this.height}},{key:"clone",get:function(){return e.createFromRectangle(this)}}]),a(e,[{key:"intersects",value:function(){var t=arguments.length<=0||void 0===arguments[0]?new e:arguments[0];return!(t.left>this.right||t.right<this.left||t.top>this.bottom||t.bottom<this.top)}},{key:"contains",value:function(t){return t instanceof e?this.containsRect(t):t instanceof l.Point?this.containsPoint(t):!1}},{key:"extend",value:function(t){var e=Math.min(this.left,t.left),i=Math.max(this.right,t.right),n=Math.min(this.top,t.top),o=Math.max(this.bottom,t.bottom);return this.size(e,n,i-e,o-n),this}},{key:"setCenter",value:function(){var t=arguments.length<=0||void 0===arguments[0]?new l.Point:arguments[0],e=t.substract(this.center);return this.translate(e.x,e.y),this}},{key:"setCenterX",value:function(){var t=arguments.length<=0||void 0===arguments[0]?0:arguments[0],e=t-this.center.x;return this.translate(e,0),this}},{key:"setCenterY",value:function(){var t=arguments.length<=0||void 0===arguments[0]?0:arguments[0],e=t-this.center.y;return this.translate(0,e),this}},{key:"containsPoint",value:function(){var t=arguments.length<=0||void 0===arguments[0]?new l.Point:arguments[0];return t instanceof l.Point?t.x>=this.left&&t.y>=this.top&&t.x<=this.right&&t.y<=this.bottom:!1}},{key:"containsRect",value:function(){var t=arguments.length<=0||void 0===arguments[0]?new e:arguments[0];return t instanceof e?t.left>=this.left&&t.top>=this.top&&t.right<=this.right&&t.bottom<=this.bottom:!1}},{key:"getDistortedRect",value:function(){var t=arguments.length<=0||void 0===arguments[0]?1:arguments[0];return new e(this.x,this.y,this.width,this.height).scaleX(t)}},{key:"getNormalRect",value:function(){var t=arguments.length<=0||void 0===arguments[0]?1:arguments[0];return new e(this.x,this.y,this.width,this.height).scaleX(1/t)}},{key:"scaleX",value:function(){var t=arguments.length<=0||void 0===arguments[0]?1:arguments[0];return this.x*=t,this.width*=t,this}},{key:"scaleY",value:function(){var t=arguments.length<=0||void 0===arguments[0]?1:arguments[0];return this.y*=t,this.height*=t,this}},{key:"scale",value:function(){var t=arguments.length<=0||void 0===arguments[0]?1:arguments[0],e=arguments.length<=1||void 0===arguments[1]?t:arguments[1];return this.scaleX(t),this.scaleY(e),this}},{key:"scaleCenter",value:function(){var t=arguments.length<=0||void 0===arguments[0]?1:arguments[0],e=arguments.length<=1||void 0===arguments[1]?t:arguments[1],i=this.clone.center;return this.scale(t,e),this.setCenter(i),this}},{key:"translate",value:function(){var t=arguments.length<=0||void 0===arguments[0]?0:arguments[0],i=arguments.length<=1||void 0===arguments[1]?t:arguments[1];return s(Object.getPrototypeOf(e.prototype),"translate",this).call(this,t,i),this}},{key:"transform",value:function(){var t=arguments.length<=0||void 0===arguments[0]?0:arguments[0],e=arguments.length<=1||void 0===arguments[1]?t:arguments[1],i=arguments.length<=2||void 0===arguments[2]?0:arguments[2],n=arguments.length<=3||void 0===arguments[3]?0:arguments[3];return this.translate(t,e),this.width+=i,this.height+=n,this}},{key:"position",value:function(){var t=arguments.length<=0||void 0===arguments[0]?0:arguments[0],i=arguments.length<=1||void 0===arguments[1]?0:arguments[1];return s(Object.getPrototypeOf(e.prototype),"position",this).call(this,t,i),this}},{key:"size",value:function(){var t=arguments.length<=0||void 0===arguments[0]?0:arguments[0],e=arguments.length<=1||void 0===arguments[1]?t:arguments[1],i=arguments.length<=2||void 0===arguments[2]?0:arguments[2],n=arguments.length<=3||void 0===arguments[3]?0:arguments[3];return this.position(t,e),this.width=i,this.height=n,this}},{key:"setSize",value:function(){var t=arguments.length<=0||void 0===arguments[0]?0:arguments[0],e=arguments.length<=1||void 0===arguments[1]?t:arguments[1];return this.width=t,this.height=e,this}},{key:"equals",value:function(t){return t instanceof e?this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height:!1}}]),e}(l.Point);u.createFromRectangle=function(t){return new u(t.x,t.y,t.width,t.height)}},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=e.Point=function(){function t(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],n=arguments.length<=1||void 0===arguments[1]?0:arguments[1];return i(this,t),this.x=e,this.y=n,this}return n(t,[{key:"length",get:function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}},{key:"clone",get:function(){return t.createFromPoint(this)}},{key:"abs",get:function(){return new t(Math.abs(this.x),Math.abs(this.y))}}]),n(t,[{key:"substract",value:function(){var e=arguments.length<=0||void 0===arguments[0]?new t:arguments[0];return this.x-=e.x,this.y-=e.y,this}},{key:"add",value:function(){var e=arguments.length<=0||void 0===arguments[0]?new t:arguments[0];return this.x+=e.x,this.y+=e.y,this}},{key:"multiply",value:function(){var t=arguments.length<=0||void 0===arguments[0]?1:arguments[0],e=arguments.length<=1||void 0===arguments[1]?t:arguments[1];return this.x*=t,this.y*=e,this}},{key:"divide",value:function(){var t=arguments.length<=0||void 0===arguments[0]?1:arguments[0],e=arguments.length<=1||void 0===arguments[1]?t:arguments[1];return this.x/=t,this.y/=e,this}},{key:"equals",value:function(t){return this.x===t.x&&this.y===t.y}},{key:"distance",value:function(){var e=arguments.length<=0||void 0===arguments[0]?new t:arguments[0];return this.clone.substract(e).length}},{key:"translate",value:function(){var t=arguments.length<=0||void 0===arguments[0]?0:arguments[0],e=arguments.length<=1||void 0===arguments[1]?t:arguments[1];return this.x+=t,this.y+=e,this}},{key:"position",value:function(){var t=arguments.length<=0||void 0===arguments[0]?0:arguments[0],e=arguments.length<=1||void 0===arguments[1]?t:arguments[1];return this.x=t,this.y=e,this}},{key:"toArray",value:function(){return[this.x,this.y]}}]),t}();o.createFromPoint=function(t){return new o(t.x,t.y)}},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.View=void 0;var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i(2),s=i(3),a=i(8),l=i(10),u=i(11),h=i(7),c=i(12),d=i(5);i(13),e.View=function(){function t(e){var i=e.viewport,o=void 0===i?new h.Rectangle:i,r=e.currentView,s=void 0===r?new h.Rectangle:r,c=e.bounds,v=void 0===c?new u.Bounds:c,f=e.center,p=void 0===f?new l.LatLng:f,g=e.initialCenter,y=void 0===g?new l.LatLng:g,m=e.data,w=void 0===m?{}:m,b=(e.$container,e.context),k=void 0===b?null:b,E=e.maxZoom,T=void 0===E?1.5:E,M=e.currentZoom,P=void 0===M?1:M,x=e.minZoom,C=void 0===x?.8:x,S=e.limitToBounds;n(this,t),this.currentView=s,this.originalMapView=s.clone,this.viewport=o,this.bounds=v,this.center=p,this.zoomFactor=P,this.maxZoom=T,this.minZoom=C,this.origin=new a.Point,this.eventManager=new d.Publisher,this.limitToBounds=S||v,this.isInitialized=!1;var O=this.viewport.center.substract(this.convertLatLngToPoint(p));return this.currentView.position(O.x,O.y),this.tiles=[],this.data=w,this.context=k,this.initial={position:y,zoom:this.zoomFactor},this.zoom(0,this.viewport.center).loadThumb()}return o(t,[{key:"distortionFactor",get:function(){return this.getDistortionFactorForLatitude(this.center)}},{key:"offsetToCenter",get:function(){return(this.viewport.width-this.viewport.width*this.distortionFactor)/2}},{key:"visibleTiles",get:function(){var t=this;return this.tiles.filter(function(e){var i=e.clone.scale(t.zoomFactor,t.zoomFactor).getDistortedRect(t.distortionFactor).translate(t.currentView.x*t.distortionFactor+t.offsetToCenter,t.currentView.y);return t.viewport.intersects(i)})}},{key:"pixelPerLatLng",get:function(){return new a.Point(this.currentView.width/this.bounds.width,this.currentView.height/this.bounds.height)}}]),o(t,[{key:"init",value:function(){return this.initializeTiles(),this.isInitialized=!0,this}},{key:"reset",value:function(){this.setLatLngToPosition(this.initial.position,this.viewport.center);var t=this.initial.zoom-this.zoomFactor;this.zoom(t,this.viewport.center)}},{key:"checkBoundaries",value:function(){var t=this.convertLatLngToPoint(this.limitToBounds.nw),e=this.convertLatLngToPoint(this.limitToBounds.se),i=new h.Rectangle(t.x+this.currentView.x,t.y+this.currentView.y,e.x-t.x,e.y-t.y),n=new a.Point,o=i.getDistortedRect(this.distortionFactor).translate(this.offsetToCenter,0);o.containsRect(this.viewport)||(o.width>=this.viewport.width?(o.left-this.viewport.left>0&&(n.x-=o.left-this.viewport.left),o.right-this.viewport.right<0&&(n.x-=o.right-this.viewport.right)):(this.currentView.setCenterX(this.viewport.center.x),n.x=0),o.height>=this.viewport.height?(o.top-this.viewport.top>0&&(n.y-=o.top-this.viewport.top),o.bottom-this.viewport.bottom<0&&(n.y-=o.bottom-this.viewport.bottom)):(this.currentView.setCenterY(this.viewport.center.y),n.y=0)),n.multiply(1/this.distortionFactor,1),this.currentView.translate(n.x,n.y)}},{key:"loadThumb",value:function(){var t=this;return r.Helper.loadImage(this.data.thumb,function(e){t.thumb=e,t.eventManager.publish(s.Events.View.THUMB_LOADED)}),this}},{key:"convertPointToLatLng",value:function(t){return t.divide(this.pixelPerLatLng.x,this.pixelPerLatLng.y),new l.LatLng(this.bounds.nw.lat-t.y,t.x+this.bounds.nw.lng).multiply(-1)}},{key:"setLatLngToPosition",value:function(t,e){var i=this.currentView.topLeft.substract(e).multiply(-1),n=i.substract(this.convertLatLngToPoint(t));return this.currentView.translate(0,n.y),this.calculateNewCenter(),this.currentView.translate(n.x+this.getDeltaXToCenter(e),0),this}},{key:"convertLatLngToPoint",value:function(t){var e=this.bounds.nw.clone.substract(t);return e.multiply(this.pixelPerLatLng.y,this.pixelPerLatLng.x),
new a.Point(e.lng,e.lat).abs}},{key:"getDeltaXToCenter",value:function(t){var e=t.clone.substract(this.viewport.center),i=e.x/this.viewport.center.x,n=i*this.offsetToCenter;return n/this.distortionFactor}},{key:"zoom",value:function(t,e){this.zoomFactor=Math.max(Math.min(this.zoomFactor+t,this.maxZoom),this.minZoom);var i=this.currentView.topLeft.substract(e).multiply(-1);i.x+=this.getDeltaXToCenter(e);var n=this.convertPointToLatLng(i).multiply(-1),o=this.originalMapView.clone.scale(this.zoomFactor);return this.currentView.setSize(o.width,o.height),this.setLatLngToPosition(n,e),this.moveView(new a.Point),this.zoomFactor>=this.maxZoom?this.eventManager.publish(s.Events.TileMap.NEXT_LEVEL):this.zoomFactor<=this.minZoom&&this.eventManager.publish(s.Events.TileMap.PREVIOUS_LEVEL),this}},{key:"getDistortionFactorForLatitude",value:function(t){return Math.cos(r.Helper.toRadians(t.lat))}},{key:"calculateNewCenter",value:function(){var t=this.viewport.center.substract(this.currentView.topLeft);return this.center=this.convertPointToLatLng(t),this}},{key:"moveView",value:function(t){return this.currentView.translate(0,t.y),this.calculateNewCenter(),this.currentView.translate(t.x*(1/this.distortionFactor),0),this}},{key:"draw",value:function(){return this.drawThumbnail().drawVisibleTiles()}},{key:"drawVisibleTiles",value:function(){return r.Helper.forEach(this.visibleTiles,function(t){return t.draw()}),this}},{key:"drawThumbnail",value:function(){if(this.thumb){var t=this.currentView.getDistortedRect(this.distortionFactor).translate(this.offsetToCenter,0);this.context.drawImage(this.thumb,0,0,this.thumb.width,this.thumb.height,t.x,t.y,t.width,t.height)}return this}},{key:"initializeTiles",value:function(){var t=this,e=this.data.tiles;return r.Helper.forEach(e,function(e){t.tiles.push(new c.Tile(e,t))}),this}}]),t}()},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=e.LatLng=function(){function t(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],n=arguments.length<=1||void 0===arguments[1]?0:arguments[1];return i(this,t),this.lat=e,this.lng=n,this}return n(t,[{key:"length",get:function(){return Math.sqrt(Math.pow(this.lat,2)+Math.pow(this.lng,2))}},{key:"clone",get:function(){return t.createFromLatLng(this)}}]),n(t,[{key:"substract",value:function(){var e=arguments.length<=0||void 0===arguments[0]?new t:arguments[0];return this.lat-=e.lat,this.lng-=e.lng,this}},{key:"add",value:function(){var e=arguments.length<=0||void 0===arguments[0]?new t:arguments[0];return this.lat+=e.lat,this.lng+=e.lng,this}},{key:"divide",value:function(){var t=arguments.length<=0||void 0===arguments[0]?1:arguments[0],e=arguments.length<=1||void 0===arguments[1]?t:arguments[1];return this.lat/=t,this.lng/=e,this}},{key:"multiply",value:function(){var t=arguments.length<=0||void 0===arguments[0]?1:arguments[0],e=arguments.length<=1||void 0===arguments[1]?t:arguments[1];return this.lat*=t,this.lng*=e,this}},{key:"equals",value:function(t){return this.lat===t.lat&&this.lng===t.lng}},{key:"toString",value:function(){return"("+this.lat+", "+this.lng+")"}}]),t}();o.createFromLatLng=function(t){return new o(t.lat,t.lng)}},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.Bounds=void 0;var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i(10);e.Bounds=function(){function t(){var e=arguments.length<=0||void 0===arguments[0]?new r.LatLng:arguments[0],i=arguments.length<=1||void 0===arguments[1]?new r.LatLng:arguments[1];if(n(this,t),e.lat<i.lat||e.lng>i.lng)throw new Error(e+" needs to be top-right corner and "+i+" bottom-left");return this.nw=e,this.se=i,this}return o(t,[{key:"width",get:function(){return Math.abs(this.se.lng-this.nw.lng)}},{key:"height",get:function(){return Math.abs(this.se.lat-this.nw.lat)}}]),t}()},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0}),e.Tile=void 0;var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=function d(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:d(o,e,i)}if("value"in n)return n.value;var r=n.get;if(void 0!==r)return r.call(i)},l=i(2),u=i(6),h=i(7),c=[{value:0,description:"Starting"},{value:1,description:"Initialized"},{value:2,description:"Loaded"},{value:3,description:"Drawn"}];e.Tile=function(t){function e(){var t,i=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=i.path,s=void 0===r?null:r,a=i.x,l=void 0===a?0:a,h=i.y,d=void 0===h?0:h,v=i.w,f=void 0===v?0:v,p=i.h,g=void 0===p?0:p,y=arguments.length<=1||void 0===arguments[1]?null:arguments[1];n(this,e);var m=o(this,Object.getPrototypeOf(e).call(this,l,d,f,g));if(!s||"string"!=typeof s||0===s.length)throw new TypeError("Path "+s+" needs to be of type string and should not be empty");if(!y)throw new Error("Tile needs an instance");return m.state=new u.StateHandler(c),m.instance=y,m.context=m.instance.context,m.path=s,t=m,o(m,t)}return r(e,t),s(e,[{key:"initialize",value:function(){var t=this;return this.state.next(),l.Helper.loadImage(this.path,function(e){t.img=e,t.state.next(),t.draw()}),this}},{key:"draw",value:function(){var t=this.clone.scale(this.instance.zoomFactor).translate(this.instance.currentView.x,this.instance.currentView.y).scaleX(this.instance.distortionFactor).translate(this.instance.offsetToCenter,0);if(this.state.current.value>=2){if(!this.context)return console.error("context not specified",this),!1;this.state.next(),this.context.drawImage(this.img,t.x,t.y,t.width,t.height)}else 0===this.state.current.value&&this.initialize();return this}},{key:"equals",value:function(t){return t instanceof e?a(Object.getPrototypeOf(e.prototype),"equals",this).call(this,t)&&this.path===t.path:!1}}]),e}(h.Rectangle)},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.MarkerClusterer=void 0;var o=function(){function t(t,e){var i=[],n=!0,o=!1,r=void 0;try{for(var s,a=t[Symbol.iterator]();!(n=(s=a.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(l){o=!0,r=l}finally{try{!n&&a["return"]&&a["return"]()}finally{if(o)throw r}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=i(3),a=i(5),l=i(14);e.MarkerClusterer=function(){function t(e){var i=e.markers,o=void 0===i?[]:i,r=e.$container,s=void 0===r?null:r;return n(this,t),this.markers=o,this.$container=s,this.clusters=[],this.eventManager=new a.Publisher,this.bindEvents(),this.clusterize(),this}return r(t,[{key:"bindEvents",value:function(){var t=this;this.eventManager.subscribe(s.Events.MarkerClusterer.CLUSTERIZE,function(){t.clusterize()}),this.eventManager.subscribe(s.Events.MarkerClusterer.UNCLUSTERIZE,function(){t.deleteAllClusters()})}},{key:"clusterize",value:function(){this.deleteAllClusters();var t=!0,e=!1,i=void 0;try{for(var n,r=this.markers.entries()[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var s=o(n.value,2),a=(s[0],s[1]),l=[],u=!0,h=!1,c=void 0;try{for(var d,v=this.clusters.entries()[Symbol.iterator]();!(u=(d=v.next()).done);u=!0){var f=o(d.value,2),p=(f[0],f[1]);a.boundingBox.intersects(p.boundingBox)&&l.push(p)}}catch(g){h=!0,c=g}finally{try{!u&&v["return"]&&v["return"]()}finally{if(h)throw c}}if(l.length){var y=this.findNearestHit(a,l);y.addMarker(a)}else{var m=this.createCluster(a);this.clusters.push(m)}}}catch(g){e=!0,i=g}finally{try{!t&&r["return"]&&r["return"]()}finally{if(e)throw i}}var w=!0,b=!1,k=void 0;try{for(var E,T=this.clusters.entries()[Symbol.iterator]();!(w=(E=T.next()).done);w=!0){var M=o(E.value,2),p=(M[0],M[1]);p.init()}}catch(g){b=!0,k=g}finally{try{!w&&T["return"]&&T["return"]()}finally{if(b)throw k}}}},{key:"findNearestHit",value:function(t,e){var i=void 0,n=void 0,r=!0,s=!1,a=void 0;try{for(var l,u=e.entries()[Symbol.iterator]();!(r=(l=u.next()).done);r=!0){var h=o(l.value,2),c=(h[0],h[1]);if(i){var d=this.getDistance(t,c);i>d&&(i=d,n=c)}else i=this.getDistance(t,c),n=c}}catch(v){s=!0,a=v}finally{try{!r&&u["return"]&&u["return"]()}finally{if(s)throw a}}return n}},{key:"getDistance",value:function(t,e){return t.boundingBox.center.distance(e.boundingBox.center)}},{key:"createCluster",value:function(t){var e=new l.Cluster({$container:this.$container});return e.addMarker(t),e}},{key:"deleteAllClusters",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this.clusters.entries()[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var s=o(n.value,2),a=(s[0],s[1]);a.removeFromDOM()}}catch(l){e=!0,i=l}finally{try{!t&&r["return"]&&r["return"]()}finally{if(e)throw i}}this.clusters=[]}}]),t}()},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.Cluster=void 0;var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=i(1),a=n(s),l=i(3),u=i(5),h=i(8);e.Cluster=function(){function t(e){var i=e.$container,n=void 0===i?null:i;return o(this,t),this.markers=[],this.$container=n,this.eventManager=new u.Publisher,this}return r(t,[{key:"init",value:function(){1===this.markers.length?this.markers[0].$icon.show():this.createClusterMarker()}},{key:"createClusterMarker",value:function(){var t=void 0,e=!0,i=!1,n=void 0;try{for(var o,r=this.markers[Symbol.iterator]();!(e=(o=r.next()).done);e=!0){var s=o.value;s.$icon.hide();var l=new h.Point(parseFloat(s.icon.style.left),parseFloat(s.icon.style.top));t=t?t.add(l):l}}catch(u){i=!0,n=u}finally{try{!e&&r["return"]&&r["return"]()}finally{if(i)throw n}}t.divide(this.markers.length),this.$cluster=(0,a["default"])("<div class='cluster'>"+this.markers.length+"</div>").css({left:t.x+"%",top:t.y+"%"}),this.$container.append(this.$cluster),this.bindEvents()}},{key:"bindEvents",value:function(){var t=this;this.$cluster.on("touchstart",function(t){t.stopPropagation()}),this.$cluster.on("touchend",function(t){t.stopPropagation()}),this.$cluster.on(l.Events.Handling.CLICK,function(){t.eventManager.publish(l.Events.TileMap.ZOOM_TO_BOUNDS,t.boundingBox)})}},{key:"addMarker",value:function(t){this.markers.push(t),this.boundingBox=this.boundingBox?this.boundingBox.extend(t.boundingBox):t.boundingBox}},{key:"removeFromDOM",value:function(){if(this.markers.length>1){var t=!0,e=!1,i=void 0;try{for(var n,o=this.markers[Symbol.iterator]();!(t=(n=o.next()).done);t=!0){var r=n.value;r.$icon.show()}}catch(s){e=!0,i=s}finally{try{!t&&o["return"]&&o["return"]()}finally{if(e)throw i}}this.$cluster.remove()}}}]),t}()},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.Marker=void 0;var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=i(1),a=n(s),l=i(3),u=(i(2),i(8)),h=i(7),c=i(5),d=i(16),v=e.Marker=function(){function t(){var e=arguments.length<=0||void 0===arguments[0]?d.DataEnrichment.DATA_MARKER:arguments[0],i=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if(o(this,t),!i)throw new Error("Tile needs an instance");return this.instance=i,this.id=t.count,t.count++,this.size=e.size,this.hover=e.hover,this.hover&&this.size.divide(2,1),this.img=e.icon,this.offset=e.offset.add(new u.Point(-(this.size.x/2),-this.size.y)),this.latlng=e.latlng,this.content=e.content,this.$icon=this.addMarkerToDOM(this.instance.$markerContainer),this.icon=this.$icon[0],this.bindEvents().positionMarker()}return r(t,[{key:"boundingBox",get:function(){var t=this.icon.getBoundingClientRect();return new h.Rectangle(t.left,t.top,t.width,t.height).scaleCenter(1.2)}}]),r(t,[{key:"bindEvents",value:function(){var t=this;return this.eventManager=new c.Publisher,this.content.length&&(this.$icon.on("touchstart",function(t){t.stopPropagation()}),this.$icon.on("touchend",function(t){t.stopPropagation()}),this.$icon.on("click",function(){t.eventManager.publish(l.Events.ToolTip.OPEN,t.content),t.eventManager.publish(l.Events.Marker.DEACTIVATE),t.$icon.addClass("active")}),this.eventManager.subscribe(l.Events.Marker.DEACTIVATE,function(){t.$icon.removeClass("active")})),this}},{key:"addMarkerToDOM",value:function(t){var e=(0,a["default"])("<div class='marker' />").css({width:this.size.x+"px",height:this.size.y+"px","margin-left":this.offset.x+"px","margin-top":this.offset.y+"px","background-image":"url("+this.img+")","background-size":(this.hover?2*this.size.x:this.size.x)+"px "+this.size.y+"px"});return t&&(e.hide(),t.append(e)),e}},{key:"positionMarker",value:function(){return this.position=this.instance.view.convertLatLngToPoint(this.latlng),this.$icon&&this.$icon.css({left:this.position.x/this.instance.view.currentView.width*100+"%",top:this.position.y/this.instance.view.currentView.height*100+"%"}).show(),this}}]),t}();v.count=0},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0}),e.DataEnrichment=void 0;var o=i(1),r=(n(o),i(2)),s=i(8),a=i(10),l=i(11),u=e.DataEnrichment={marker:function(t){var e=[];return r.Helper.forEach(t,function(t){t=Object.assign(u.DATA_MARKER,t);var i=new s.Point(t.offset.x,t.offset.y),n=new a.LatLng(t.position.lat,t.position.lng),o=new s.Point(t.size.width,t.size.height);e.push({offset:i,latlng:n,size:o,hover:t.hover,icon:t.icon,content:t.content})}),e},mapSettings:function(t){var e=Object.assign(u.MAP_SETTINGS,t),i=new l.Bounds(new a.LatLng(e.bounds.northWest[0],e.bounds.northWest[1]),new a.LatLng(e.bounds.southEast[0],e.bounds.southEast[1])),n=new a.LatLng(e.center.lat,e.center.lng);return e.limitToBounds?e.limitToBounds=new l.Bounds(new a.LatLng(e.limitToBounds.northWest[0],e.limitToBounds.northWest[1]),new a.LatLng(e.limitToBounds.southEast[0],e.limitToBounds.southEast[1])):e.limitToBounds=i,e.bounds=i,e.center=n,e},tooltip:function(t){return Object.assign(t,u.TOOLTIP)}};u.DATA_MARKER={icon:null,hover:!1,position:{lat:0,lng:0},offset:{x:0,y:0},size:{width:32,height:32},content:[]},u.MAP_SETTINGS={level:0,center:{lat:0,lng:0},bounds:{northWest:[90,-180],southEast:[-90,180]},controls:{zoom:!1,home:!1,position:"bottom-right",theme:"dark"}},u.TOOLTIP={image:"/plugin/hbs/image.hbs",text:"/plugin/hbs/text.hbs",headline:"/plugin/hbs/headline.hbs",crossheading:"/plugin/hbs/crossheading.hbs",iframe:"/plugin/hbs/iframe.hbs"}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.ToolTip=void 0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(1),l=n(a),u=i(18),h=n(u),c=i(3),d=i(2),v=i(5);e.ToolTip=function(){function t(e){var i=e.container,n=e.templates;if(o(this,t),this.$container="string"==typeof i?(0,l["default"])(i):"object"===("undefined"==typeof i?"undefined":r(i))&&i instanceof jQuery?i:(0,l["default"])(i),!(this.$container instanceof jQuery))throw new Error("Container "+i+" not found");return this.$container.addClass(c.Events.ToolTip.CLOSE),this.$close=(0,l["default"])("<span class='close-button' />"),this.$content=(0,l["default"])("<div class='tooltip-content' />"),this.$popup=(0,l["default"])("<div class='tooltip-container' />").append(this.$close).append(this.$content),this.eventManager=new v.Publisher,this.bindEvents(),this.registerHandlebarHelpers(),this.setPosition().initializeTemplates(n)}return s(t,[{key:"allTemplatesLoaded",get:function(){return this.loadedTemplates===Object.keys(this.templates).length}}]),s(t,[{key:"registerHandlebarHelpers",value:function(){return h["default"]&&h["default"].registerHelper("getRatio",function(t,e){return e/t*100+"%"}),this}},{key:"initializeTemplates",value:function(t){return this.templates=t,this.loadedTemplates=0,this.compileTemplates(),this}},{key:"bindEvents",value:function(){var t=this;return(0,l["default"])(window).on(c.Events.Handling.RESIZE,function(){t.resizeHandler()}),this.eventManager.subscribe(c.Events.ToolTip.OPEN,this.open.bind(this)),this.eventManager.subscribe(c.Events.ToolTip.CLOSE,function(){t.close()}),this.$close.on(c.Events.Handling.CLICK,function(){t.close()}),this}},{key:"resizeHandler",value:function(){return this.setPosition(),this}},{key:"insertContent",value:function(){var t=this,e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return this.$content.html(""),d.Helper.forEach(e,function(e){if(t.templates[e.type]){var i=t.templates[e.type](e.content);t.$content.append(i)}}),this}},{key:"open",value:function(t){return t&&this.insertContent(t),this.$container.hasClass(c.Events.ToolTip.CLOSE)&&(this.setPosition(),this.$container.removeClass(c.Events.ToolTip.CLOSE).addClass(c.Events.ToolTip.OPEN),this.eventManager.publish(c.Events.TileMap.RESIZE)),this}},{key:"close",value:function(){return this.$container.hasClass(c.Events.ToolTip.OPEN)&&(this.eventManager.publish(c.Events.Marker.DEACTIVATE),this.setPosition(),this.$container.removeClass(c.Events.ToolTip.OPEN).addClass(c.Events.ToolTip.CLOSE),this.eventManager.publish(c.Events.TileMap.RESIZE)),this}},{key:"setPosition",value:function(){return this.$container.innerWidth()>this.$container.innerHeight()?this.$container.addClass("left").removeClass("bottom"):this.$container.addClass("bottom").removeClass("left"),this}},{key:"compileTemplates",value:function(){var t=this;return d.Helper.forEach(this.templates,function(e,i){d.Helper.getFile(e,function(e){t.templates[i]=h["default"].compile(e),t.loadedTemplates++,t.allTemplatesLoaded&&t.$container.append(t.$popup)})}),this}}]),t}()},function(t,i){t.exports=e},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.Interact=void 0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(1),l=n(a),u=i(8),h=i(2);e.Interact=function(){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];o(this,t),this.settings=Object.assign(this.getDefaultSettings(),e),this.data=this.getDefaultData(),this.settings.overwriteViewportSettings&&this.handleViewport(this.settings.overwriteViewportSettings),this.init(this.settings.container).bindEvents()}return s(t,[{key:"timeToLastMove",get:function(){return this.data.time.end-this.data.time.last}},{key:"time",get:function(){return this.data.time.end-this.data.time.start}},{key:"dataClone",get:function(){return(0,l["default"])(this.data)[0]}}]),s(t,[{key:"getDefaultSettings",value:function(){return{container:".interact-container",timeTreshold:{tap:200,hold:500,swipe:300,flick:20},distanceTreshold:{swipe:200},speedThreshold:.01,overwriteViewportSettings:!1,stopPropagation:!0,preventDefault:!0,autoFireHold:!1,pinchBalanceTime:500,callbacks:this.getDefaultCallbacks(),events:this.getDefaultEventNames()}}},{key:"getDefaultCallbacks",value:function(){return{tap:null,tapHold:null,doubletap:null,hold:null,pan:null,swipe:null,flick:null,zoom:null,wheel:null,pinch:null}}},{key:"getDefaultEventNames",value:function(){var t=h.Helper.isIE();return{start:{touch:t?"MSPointerDown pointerdown":"touchstart",mouse:t?"MSPointerDown pointerdown":"mousedown"},move:{touch:t?"MSPointerMove pointermove":"touchmove",mouse:t?"MSPointerMove pointermove":"mousemove"},end:{touch:t?"MSPointerUp pointerup":"touchend",mouse:t?"MSPointerUp pointerup":"mouseup"},leave:{touch:t?"MSPointerLeave pointerleave":"touchleave",mouse:t?"MSPointerLeave pointerleave":"mouseleave"},scroll:h.Helper.scrollEvent()}}},{key:"getDefaultData",value:function(){return{down:!1,moved:!1,pinched:!1,pointerArray:{},multitouch:!1,distance:null,directions:[],zoom:0,difference:null,target:null,last:{position:null,distance:null,action:null},position:{start:null,move:null,end:null},time:{start:null,last:null,end:null},timeout:{hold:null,"default":null}}}},{key:"handleViewport",value:function(t){"string"!=typeof t&&(t="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no");var e=(0,l["default"])("meta[name=viewport]").length,i=0!==e?(0,l["default"])("meta[name=viewport]"):(0,l["default"])("head").append((0,l["default"])("<meta name='viewport' />"));return i.attr("content",t),this}},{key:"init",value:function(t){if(this.$container="string"==typeof t?(0,l["default"])(t):"object"===("undefined"==typeof t?"undefined":r(t))&&t instanceof jQuery?t:(0,l["default"])(t),!(this.$container instanceof jQuery))throw new Error("Container "+t+" not found");var e={"-ms-touch-action":"none","touch-action":"none","-ms-content-zooming":"none"};return this.$container.css(e),this.$container.find("> *").css(e),this.container=this.$container[0],this}},{key:"bindEvents",value:function(){return h.Helper.isIE()?this.bindIEEvents():(h.Helper.isTouch()&&this.bindTouchEvents(),h.Helper.isMouse()&&this.bindMouseEvents()),this}},{key:"bindIEEvents",value:function(){return this.$container.on(this.settings.events.scroll,this.scrollHandler.bind(this)),this.bindTouchEvents(),this.container.addEventListener("contextmenu",function(t){return t.preventDefault()},!1),this}},{key:"bindTouchEvents",value:function(){return this.$container.on(this.settings.events.start.touch,this.startHandler.bind(this)).on(this.settings.events.move.touch,this.moveHandler.bind(this)).on(this.settings.events.end.touch,this.endHandler.bind(this)).on(this.settings.events.leave.touch,this.endHandler.bind(this)),this}},{key:"bindMouseEvents",value:function(){return this.$container.on(this.settings.events.scroll,this.scrollHandler.bind(this)).on(this.settings.events.start.mouse,this.startHandler.bind(this)).on(this.settings.events.move.mouse,this.moveHandler.bind(this)).on(this.settings.events.end.mouse,this.endHandler.bind(this)).on(this.settings.events.leave.mouse,this.endHandler.bind(this)),this}},{key:"preHandle",value:function(t){return this.settings.stopPropagation&&t.stopPropagation(),this.settings.preventDefault&&t.preventDefault(),this.data.target=t.target,this.getEvent(t)}},{key:"scrollHandler",value:function(t){t=t||window.event;var e=this.preHandle(t)||t.originalEvent;return this.data.delta=this.normalizeWheelDelta(t),this.data.position.start=this.getRelativePosition(e),this.data.directions=this.getScrollDirection(e),this.data.zoom=this.data.directions.indexOf("up")>-1?1:this.data.directions.indexOf("down")>-1?-1:0,this.settings.callbacks.wheel&&this.eventCallback(this.settings.callbacks.wheel,this.dataClone),this.settings.callbacks.zoom&&(this.data.directions.indexOf("up")>-1||this.data.directions.indexOf("down")>-1)&&this.eventCallback(this.settings.callbacks.zoom,this.dataClone),!1}},{key:"normalizeWheelDelta",value:function(t){var e=t.originalEvent,i=e.wheelDelta||-1*e.deltaY*10,n=225,o=n-1,r=e.detail,s=void 0;return r=r?i&&(s=i/r)?r/s:-r/1.35:i/120,r=1>r?-1>r?(-Math.pow(r,2)-o)/n:r:(Math.pow(r,2)+o)/n,Math.min(Math.max(r/2,-1),1)}},{key:"isPointerEvent",value:function(t){return h.Helper.isIE()&&(t instanceof MSPointerEvent||t instanceof PointerEvent)}},{key:"calculateStart",value:function(t){var e={multitouch:!1,distance:0,down:!0,position:{start:new u.Point}};return t instanceof MouseEvent&&!this.isPointerEvent(t)?l["default"].extend(!0,e,this.handleSingletouchStart(t)):this.isPointerEvent(t)?this.handlePointerEventStart(e,t):this.handleTouchEventStart(e,t)}},{key:"handlePointerEventStart",value:function(t,e){this.data.pointerArray[e.pointerId]=e;var i=Object.keys(this.data.pointerArray).length<=1?this.handleSingletouchStart(e):this.handleMultitouchStart(this.getPointerArray());return l["default"].extend(!0,t,i)}},{key:"handleTouchEventStart",value:function(t,e){return this.handleTouchEvent(t,e,this.handleSingletouchStart.bind(this),this.handleMultitouchStart.bind(this))}},{key:"getPointerArray",value:function(){var t=[];for(var e in this.data.pointerArray)this.data.pointerArray[e]&&t.push(this.data.pointerArray[e]);return t}},{key:"handleMultitouchStart",value:function(t){var e=this.getRelativePosition(t[0]),i=this.getRelativePosition(t[1]);return{multitouch:!0,distance:e.distance(i),position:{start:e.add(i).divide(2,2)}}}},{key:"handleSingletouchStart",value:function(t){return{position:{start:this.getRelativePosition(t)}}}},{key:"takeActionStart",value:function(t){switch(t){case null:this.data.last.action="tap",this.settings.autoFireHold&&this.setTimeoutForEvent(this.settings.callbacks.hold,this.settings.autoFireHold,this.dataClone,!0);break;case"tap":this.data.last.action="doubletap",this.settings.autoFireHold&&this.setTimeoutForEvent(this.settings.callbacks.tapHold,this.settings.autoFireHold,this.dataClone,!0)}return this}},{key:"startHandler",value:function(t){if(t.button&&0!==t.button)return!1;var e=this.preHandle(t);return this.data.time.start=t.timeStamp,this.clearTimeouts(this.data.timeout["default"]),this.data=l["default"].extend(!0,this.data,this.calculateStart(e)),this.takeActionStart(this.data.last.action),!1}},{key:"clearTimeouts",value:function(t){return t&&(t=clearTimeout(t)),this}},{key:"calculateMove",value:function(t){var e={moved:!0,last:{action:"moved"},position:{move:new u.Point}};return t instanceof MouseEvent&&!this.isPointerEvent(t)?l["default"].extend(!0,e,this.handleSingletouchMove(t)):this.isPointerEvent(t)?this.handlePointerEventMove(e,t):this.handleTouchEventMove(e,t)}},{key:"handlePointerEventMove",value:function(t,e){if(this.data.pointerArray[e.pointerId]=e,Object.keys(this.data.pointerArray).length<=1)return l["default"].extend(!0,t,this.handleSingletouchMove(e));var i=this.getPointerArray();return l["default"].extend(!0,t,this.handleMultitouchMove(i))}},{key:"handleTouchEventMove",value:function(t,e){return this.handleTouchEvent(t,e,this.handleSingletouchMove.bind(this),this.handleMultitouchMove.bind(this))}},{key:"handleTouchEvent",value:function(t,e,i,n){var o=1===e.length?i(e[0]):n(e);return l["default"].extend(!0,t,o)}},{key:"handleMultitouchMove",value:function(t){var e=this.getRelativePosition(t[0]),i=this.getRelativePosition(t[1]),n=i.clone.add(e).divide(2);return{position:{move:n},distance:e.distance(i),multitouch:!0}}},{key:"handleSingletouchMove",value:function(t){var e=this.getRelativePosition(t);return{position:{move:e},distance:this.data.last.position.distance(e),multitouch:!1}}},{key:"moveHandler",value:function(t){if(!this.data.down||this.data.pinched)return!1;var e=this.preHandle(t);return this.data.time.last=t.timeStamp,this.data.last.position=this.data.position.move?this.data.position.move:this.data.position.start,this.data.time.last=this.data.time.last?this.data.time.last:this.data.time.start,this.positionDidNotChange(e)?!1:(this.clearTimeouts(this.data.timeout["default"]),this.clearTimeouts(this.data.timeout.hold),this.data=l["default"].extend(!0,this.data,this.calculateMove(e)),this.data.multitouch?this.handlePinchAndZoom():this.eventCallback(this.settings.callbacks.pan,this.dataClone),!1)}},{key:"handlePinchAndZoom",value:function(){return this.data.last.distance||(this.data.last.distance=this.data.distance),this.data.difference=this.data.distance-this.data.last.distance,Math.abs(this.data.difference)>=.005&&(this.settings.callbacks.pinch&&this.eventCallback(this.settings.callbacks.pinch,this.dataClone),this.settings.callbacks.zoom&&this.eventCallback(this.settings.callbacks.zoom,this.dataClone),this.data.last.distance=this.data.distance),this}},{key:"positionDidNotChange",value:function(t){return h.Helper.isIE()&&(this.getRelativePosition(t).equals(this.data.last.position)||this.getRelativePosition(t).equals(this.data.position.start))||!h.Helper.isIE()&&h.Helper.isTouch()&&this.getRelativePosition(t[0]).equals(this.data.last.position)}},{key:"calculateEnd",value:function(t){var e={position:{end:new u.Point}};if(t instanceof MouseEvent&&!this.isPointerEvent(t))return l["default"].extend(!0,e,this.handleSingletouchEnd(t));if(this.isPointerEvent(t)){var i=this.handleSingletouchEnd(t);return delete this.data.pointerArray[t.pointerId],l["default"].extend(!0,e,i)}return t.length<=1?l["default"].extend(!0,e,this.handleSingletouchEnd(t[0])):void 0}},{key:"handleSingletouchEnd",value:function(t){return{position:{end:this.getRelativePosition(t)}}}},{key:"takeActionEnd",value:function(t){switch(t){case"tap":this.time<this.settings.timeTreshold.hold?this.setTimeoutForEvent(this.settings.callbacks.tap,this.settings.timeTreshold.tap,this.dataClone):this.eventCallback(this.settings.callbacks.hold,this.dataClone);break;case"doubletap":this.time<this.settings.timeTreshold.hold?this.setTimeoutForEvent(this.settings.callbacks.doubletap,this.settings.timeTreshold.tap,this.dataClone):this.eventCallback(this.settings.callbacks.tapHold,this.dataClone);break;default:this.data.last.action=null}}},{key:"endHandler",value:function(t){var e=this.preHandle(t);return this.data.time.end=t.timeStamp,this.clearTimeouts(this.data.timeout.hold),this.data=l["default"].extend(!0,this.data,this.calculateEnd(e)),this.data.moved||!this.data.down||this.data.multitouch?this.data.moved&&this.data.down&&!this.data.multitouch&&((this.settings.callbacks.swipe||this.settings.callbacks.flick)&&this.handleSwipeAndFlick(),
this.data.last.action=null):this.takeActionEnd(this.data.last.action),this.pinchBalance(),this.handleMultitouchEnd(e),this.data.last.position=null,!1}},{key:"handleSwipeAndFlick",value:function(){var t=this.data.position.end.clone.substract(this.data.last.position),e=t.length,i=t.divide(e,e);if(this.settings.callbacks.swipe&&this.time<=this.settings.timeTreshold.swipe){var n=this.getAbsolutePosition(this.data.position.start),o=this.getAbsolutePosition(this.data.position.end);o.distance(n)>=this.settings.distanceTreshold.swipe&&(this.data.directions=this.getSwipeDirections(i),this.eventCallback(this.settings.callbacks.swipe,this.dataClone))}if(this.settings.callbacks.flick&&this.timeToLastMove<=this.settings.timeTreshold.flick){var r=this.data.last.position.distance(this.data.position.end);this.data.distance=r;var s=this.data.last.position.clone.substract(this.data.position.end);this.data.directions=[s.x,s.y],this.data.speed=this.calculateSpeed(r,this.time),this.data.speed>=this.settings.speedThreshold&&this.eventCallback(this.settings.callbacks.flick,this.dataClone)}return this}},{key:"handleMultitouchEnd",value:function(t){return this.data.multitouch=!1,this.data.down=!1,this.data.moved=!1,this.isPointerEvent(t)?Object.keys(this.data.pointerArray).length>1?this.data.multitouch=!0:Object.keys(this.data.pointerArray).length>0&&(this.data.down=!0):(t.length>1?this.data.multitouch=!0:t.length>0&&(this.data.down=!0),this.data.position.move=null),this}},{key:"pinchBalance",value:function(){return this.data.multitouch&&(this.data.pinched=!0,setTimeout(function(){this.data.pinched=!1,this.data.last.distance=null}.bind(this),this.settings.pinchBalanceTime)),this}},{key:"calculateSpeed",value:function(t,e){return t/(e||1e-5)*100}},{key:"getSwipeDirections",value:function(t){return[t.x<0?"left":t.x>0?"right":"none",t.y<0?"up":t.y>0?"down":"none"]}},{key:"setTimeoutForEvent",value:function(t,e,i,n){return n?this.data.timeout.hold=setTimeout(this.eventCallback.bind(this,t,i),e):this.data.timeout["default"]=setTimeout(this.eventCallback.bind(this,t,i),e),this}},{key:"eventCallback",value:function(t,e){return t&&"function"==typeof t&&t(e),this.data.last.action=null,this}},{key:"getRelativePosition",value:function(t){var e=this.container.getBoundingClientRect(),i=new u.Point(t.clientX,t.clientY),n=new u.Point(e.left,e.top);return i.substract(n).divide(e.width,e.height)}},{key:"getAbsolutePosition",value:function(t){var e=this.container.getBoundingClientRect();return t.mult(e.width,e.height)}},{key:"getScrollDirection",value:function(t){var e=parseInt(t.axis,10),i=[];return this.isDownDirection(e,t)?i.push("down"):this.isUpDirection(e,t)&&i.push("up"),this.isRightDirection(e,t)?i.push("right"):this.isLeftDirection(e,t)&&i.push("left"),i}},{key:"isDownDirection",value:function(t,e){return e.deltaY>0||!e.deltaY&&e.wheelDeltaY<0||2===t&&e.detail>0||Math.max(-1,Math.min(1,e.wheelDelta||-e.detail))<0}},{key:"isUpDirection",value:function(t,e){return e.deltaY<0||!e.deltaY&&e.wheelDeltaY>0||2===t&&e.detail<0||Math.max(-1,Math.min(1,e.wheelDelta||-e.detail))>0}},{key:"isRightDirection",value:function(t,e){return e.deltaX>0||!e.deltaX&&e.wheelDeltaX>0||1===t&&e.detail>0}},{key:"isLeftDirection",value:function(t,e){return e.deltaX<0||!e.deltaX&&e.wheelDeltaX<0||1===t&&e.detail<0}},{key:"getEvent",value:function(t){return jQuery.event.fix(t),t.originalEvent.touches&&0===t.originalEvent.touches.length?t.originalEvent.changedTouches||t.originalEvent:t.originalEvent.touches||t.originalEvent.changedTouches||t.originalEvent}}]),t}()}])});
//# sourceMappingURL=mappedJS.min.js.map